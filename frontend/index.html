<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IAseroría Informática - Consultoría Técnica</title>
    <link rel="stylesheet" href="styles.css"> <style>
        /* Un poco de estilo rápido para la nueva experiencia */
        .hidden { display: none; }
        .success-card {
            text-align: center;
            padding: 40px;
            border-radius: 15px;
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
        }
        input:invalid { border-color: #ef4444; }
        .hint { font-size: 0.8rem; color: #666; margin-top: 4px; }
    </style>
</head>
<body>

    <div class="container">
        <div id="form-container">
            <h1>Nueva Solicitud de Asesoría</h1>
            <p>Completa tus datos para iniciar el análisis de viabilidad con IA.</p>
            
            <form id="asesoria-form" onsubmit="enviarVersion2(event)">
                <div class="field">
                    <label>Nombre Completo</label>
                    <input type="text" id="name" required placeholder="Ej: Juan Pérez">
                </div>

                <div class="field">
                    <label>Teléfono de Contacto</label>
                    <input type="tel" id="phone" required 
                           pattern="569[0-9]{8}" 
                           placeholder="56912345678">
                    <p class="hint">Formato: 569 + 8 dígitos</p>
                </div>

                <div class="field">
                    <label>Correo Electrónico</label>
                    <input type="email" id="email" required placeholder="tu@correo.com">
                </div>

                <div class="field">
                    <label>Cuéntanos sobre tu proyecto o problema</label>
                    <textarea id="client-input" required rows="5" 
                              placeholder="Describe aquí lo que necesitas impulsar..."></textarea>
                </div>

                <button type="submit" class="btn-finalizar" id="btn-submit">
                    <span id="btn-text">Enviar Solicitud</span>
                    <div id="spinner" class="spinner hidden"></div>
                </button>
            </form>
        </div>

        <div id="success-message" class="success-card hidden">
            <div style="font-size: 3rem;">✅</div>
            <h2>¡Solicitud Registrada con Éxito!</h2>
            <p>Estamos procesando tu información con nuestro sistema de IA.</p>
            <hr>
            <p><strong>¿Qué pasará ahora?</strong></p>
            <p>En unos <strong>15 minutos</strong> recibirás un correo electrónico de <strong>IAseroria.Informatica@gmail.com</strong> con el resumen técnico de viabilidad y los pasos a seguir.</p>
            <br>
            <p><em>"Gracias por permitirnos ayudarte a seguir creciendo"</em></p>
            <button onclick="location.reload()" style="margin-top:20px;">Enviar otra consulta</button>
        </div>
    </div>

    <script>
        async function enviarVersion2(event) {
            event.preventDefault(); // Evita que la página recargue

            const btn = document.getElementById('btn-submit');
            const btnText = document.getElementById('btn-text');
            const spinner = document.getElementById('spinner');
            const formContainer = document.getElementById('form-container');
            const successMessage = document.getElementById('success-message');

            // 1. Mostrar estado de carga
            btn.disabled = true;
            btnText.innerText = "Registrando...";
            spinner.classList.remove('hidden');

            const payload = {
                nombre: document.getElementById('name').value,
                telefono: document.getElementById('phone').value,
                correo: document.getElementById('email').value,
                texto_original: document.getElementById('client-input').value
            };

            try {
                // Enviamos a la nueva ruta que crearemos en app.py (V2)
                const response = await fetch('/secretario/guardar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    // 2. Transición inmediata al mensaje de éxito
                    formContainer.classList.add('hidden');
                    successMessage.classList.remove('hidden');
                } else {
                    throw new Error("Error en el servidor");
                }

            } catch (error) {
                alert("Hubo un problema. Por favor verifica tu conexión e intenta de nuevo.");
                btn.disabled = false;
                btnText.innerText = "Enviar Solicitud";
                spinner.classList.add('hidden');
            }
        }
    </script>
</body>
</html>